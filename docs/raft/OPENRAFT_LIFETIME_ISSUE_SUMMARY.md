# OpenRaft 0.9.21 Lifetime Parameter Issue Summary

## Problem Description

The Kiwi Raft implementation encounters compilation errors when trying to implement OpenRaft 0.9.21 storage traits due to lifetime parameter mismatches. The error manifests as:

```
error[E0195]: lifetime parameters or bounds on method `save_vote` do not match the trait declaration
```

This occurs for all methods in the `RaftStorage`, `RaftLogReader`, and `RaftSnapshotBuilder` traits.

## Root Cause

OpenRaft 0.9.21 uses sealed traits with specific lifetime requirements that are not compatible with manual trait implementations using the `async_trait` macro. The lifetime parameters generated by `async_trait` don't match the exact signatures expected by OpenRaft's trait definitions.

## Affected Files

The following files contain problematic trait implementations:
- `src/raft/src/correct_adaptor.rs` - Attempted correct implementation
- `src/raft/src/adaptor_poc.rs` - Proof of concept implementation  
- `src/raft/src/minimal_storage.rs` - Minimal storage implementation

All of these files produce the same E0195 lifetime parameter mismatch errors.

## Current Workaround

The problematic modules have been temporarily disabled by adding `#[cfg(test)]` attributes, and the `RaftNode::new()` method returns an error indicating the implementation is incomplete:

```rust
Err(RaftError::Configuration {
    message: "Raft implementation is not yet complete - OpenRaft 0.9.21 trait lifetime compatibility issues".to_string(),
    context: "new".to_string(),
})
```

This allows the codebase to compile successfully while the issue is being resolved.

## Potential Solutions

### 1. Use OpenRaft's Built-in Storage (Recommended)

OpenRaft may provide built-in memory or file-based storage implementations that can be used directly without implementing the sealed traits manually.

### 2. Use External Storage Crates

Look for community-maintained storage implementations compatible with OpenRaft 0.9.21:
- `openraft-memstore` - Memory-based storage
- `openraft-rocksdb` - RocksDB-based storage

### 3. Downgrade OpenRaft Version

Consider using an earlier version of OpenRaft (e.g., 0.8.x) that may have more flexible trait requirements.

### 4. Use OpenRaft Examples

Study the official OpenRaft examples and documentation to understand the correct way to implement storage for version 0.9.21.

### 5. Macro-based Implementation

Investigate if OpenRaft provides macros or helper functions to generate correct trait implementations.

## Next Steps

1. **Research OpenRaft Documentation**: Check the official OpenRaft 0.9.21 documentation and examples for the correct implementation pattern.

2. **Examine OpenRaft Source**: Look at the actual trait definitions in OpenRaft 0.9.21 to understand the exact lifetime requirements.

3. **Community Resources**: Check the OpenRaft GitHub repository for issues, discussions, or examples related to storage implementation.

4. **Consider Alternatives**: Evaluate whether using a different Raft library or version would be more suitable for the project requirements.

## Compilation Status

✅ **Current Status**: The codebase compiles successfully with the workaround in place.
❌ **Raft Functionality**: Raft consensus is not functional until the storage implementation is completed.

## Files Modified

- `src/raft/src/lib.rs` - Added `#[cfg(test)]` to problematic modules
- `src/raft/src/node.rs` - Added placeholder error return in `RaftNode::new()`

The original trait implementations are preserved in the test-only modules for future reference and debugging.